<script src="throttledRequest.js"></script>
<script>
    for (let i = 1; i <= 20; i++) {
        let tag = `Request ${i}`;
        let start = Date.now();
        let method = 'GET';
        let url = 'https://jsonplaceholder.typicode.com/todos/1';

        let type = (0 === i % 2) ? 'xhr' : 'fetch';
        if ('fetch' === type) {
            utils.fetch(
                url,
                { method: method },
                () => console.log(`${tag} (${type}) sent after queued for ` + (Date.now() - start) + ' ms.')
            );
            // .then((res) => { console.log(`${tag} (${type}) response after ` + (Date.now() - start) + ' ms.'); })
            // .catch((err) => { console.log(`${tag} (${type}) error`, err); });
        } else if ('xhr' === type) {
            let xhr = utils.XMLHttpRequest(() => {
                console.log(`${tag} (${type}) sent after queued for ` + (Date.now() - start) + ' ms.');
            });
            // xhr.onreadystatechange = function () {
            //     if (XMLHttpRequest.DONE === xhr.readyState) {
            //         console.log(`${tag} (${type}) response after ` + (Date.now() - start) + ' ms.');
            //     }
            // };
            // xhr.onerror = function () {
            //     console.log(`${tag} (${type}) network error`);
            // };
            xhr.open(method, url);
            xhr.send();
        }
    }
</script>
